<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!--
	guiedit - PukiWiki Plugin

	License:
	  GNU General Public License Version 2 or later (GPL)
	  http://www.gnu.org/licenses/gpl.html

	Copyright (C) 2006-2007 garand
	PukiWiki : Copyright (C) 2001-2006 PukiWiki Developers Team
	FCKeditor : Copyright (C) 2003-2007 Frederico Caldeira Knabben
-->
<html>
	<head>
		<title>Attachment Properties</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta content="noindex, nofollow" name="robots">
		<script language="javascript">

var oEditor = window.parent.InnerDialogLoaded() ;

var FCKSelection = oEditor.FCKSelection;
var FCKLang = oEditor.FCKLang ;
var PukiWikiPlugin = oEditor.PukiWikiPlugin;
var XpWiki = window.parent.window.parent.XpWiki;

var eSelected;

if ( typeof window.$ != 'function' ) {
	var $ = function(elem) {
		return document.getElementById(elem);
	};
}

window.onload = function ()
{
	oEditor.FCKLanguageManager.TranslatePage(document);

	eSelected = PukiWikiPlugin.GetSelectedElement2();
		
	LoadSelected();
	
	window.parent.SetOkButton(true);
	window.parent.SetAutoSize(true);
};

window.onunload = function ()
{
	XpWiki.PopupHide();
}

function LoadSelected()
{
	//$('height').disabled = true;

	if (!eSelected)
		return ;

	if (eSelected.className == 'ref') {
		$('name').value = eSelected.getAttribute('_filename');
		$('span').checked = (eSelected.tagName == 'SPAN') ? true : false;
		$('othor').value = eSelected.getAttribute('_othor');
		$('alt').value = eSelected.getAttribute('_alt');
		if (eSelected.getAttribute('_size') > 0) {
			$('size').value = eSelected.getAttribute('_size');
			$('width').value = "";
			$('mw').value = "max";
			$('mw').disabled = true;
			$('height').value = "";
			$('mh').value = "max";
			$('mh').disabled = true;
		} else {
			if ( eSelected.getAttribute('_mw')) {
				$('width').value = eSelected.getAttribute('_mw');
				$('mw').value = 'max';
			} else {
				$('width').value = eSelected.getAttribute('_width');
				$('mw').value = 'fix';
			}
			if ( eSelected.getAttribute('_mh')) {
				$('height').value = eSelected.getAttribute('_mh');
				$('mh').value = 'max';
			} else {
				$('height').value = eSelected.getAttribute('_height');
				$('mh').value = 'fix';
			}
		}
		$('align').value = eSelected.getAttribute('_align');
		$('nolink').checked = (eSelected.getAttribute('_nolink') == 1);
		$('noicon').checked = (eSelected.getAttribute('_noicon') == 1);
		$('noimg').checked = (eSelected.getAttribute('_noimg') == 1);
		$('wrap').checked = (eSelected.getAttribute('_wrap') == 1);
		$('around').checked = (eSelected.getAttribute('_around') == 1);
		//$('zoom').checked = (eSelected.getAttribute('_zoom') == 1);
		
		if (eSelected.tagName == 'SPAN') {
			ChangeType('SPAN');
		}
	}
	else {
		eSelected == null ;
	}
}

function Ok()
{
	var sValue = new Array();
	sValue['class'] = 'ref';
	sValue['name'] = $('name').value;
	sValue['type'] = $('div').checked ? 'DIV' : 'SPAN';
	sValue['othor'] = $('othor').value;
	sValue['alt'] = $('alt').value;
	sValue['width'] = $('width').value;
	sValue['height'] = $('height').value;
	sValue['mw'] = $('mw').value;
	sValue['mh'] = $('mh').value;
	sValue['size'] = $('size').value;
	sValue['align'] = $('align').value;
	sValue['nolink'] = $('nolink').checked;
	sValue['noicon'] = $('noicon').checked;
	sValue['noimg'] = $('noimg').checked;
	sValue['wrap'] = $('wrap').checked;
	sValue['around'] = $('around').checked;
	//sValue['zoom'] = $('zoom').checked;

	if ( sValue['name'].length == 0 )
	{
		alert( FCKLang.AttachmentErrNoName ) ;
		return false ;
	}

	if (sValue['type'] == 'DIV') {
		var aTags = ['H2', 'H3', 'H4', 'H5', 'H6'];
		for (i = 0; i < aTags.length; i++) {
			if (FCKSelection.HasAncestorNode(aTags[i])) {
				alert(FCKLang.AttachmentErrInsert);
				return false;
			}
		}
	}
	if (FCKSelection.HasAncestorNode('PRE')) {
		alert(FCKLang.AttachmentErrInsert);
		return false;
	}

	if (eSelected) {
		PukiWikiPlugin.Change(eSelected, sValue);
		return true;
	}

	PukiWikiPlugin.Add(sValue);
	
	XpWiki.PopupHide();
	
	return true;
}

function Cancel() {
	XpWiki.PopupHide();
}

function ChangeType(type) {
	if (type == 'DIV') {
		$('align').disabled = false;
		$('wrap').disabled = false;
		$('around').disabled = false;
	}
	else {
		$('align').disabled = true;
		$('wrap').disabled = true;
		$('around').disabled = true;
	}
}

function ChangeSizeType(par) {
	if (par) {
		$('width').value = "";
		$('mw').value = "max";
		$('mw').disabled = true;
		$('height').value = "";
		$('mh').value = "max";
		$('mh').disabled = true;
	} else {
		$('size').value = "";
		$('mw').disabled = false;
		$('mh').disabled = false;
	}
}
		</script>
		
	</head>
	<body scroll="no" style="OVERFLOW: hidden">
		<table height="100%" cellSpacing="0" cellPadding="0" width="100%" border="0">
			<tr>
				<td>
					<table cellSpacing="0" cellPadding="2" align="center" border="0" width="100%">
						<tr>
							<td colspan="3" align="right"><form style="display: inline;"><input type="button" onclick="XpWiki.fileupFormPopup('fck');" value="File Browser" fckLang="AttachmentDlgBrowser"></form></td>
						</tr>
						<tr>
							<td><span fckLang="AttachmentDlgType">Type</span>:</td>
							<td colspan="2">
								<input id="div" name="type" type="radio" onclick="ChangeType('DIV')" checked>
								<label for="div" fckLang="AttachmentDlgDiv">Block</label>
								<input id="span" name="type" type="radio" onclick="ChangeType('SPAN')">
								<label for="span" fckLang="AttachmentDlgSpan">Inline</label>
							</td>
						</tr>
						<tr>
							<td><span fckLang="AttachmentDlgName">File Name</span>:</td>
							<td colspan="2"><input id="name" type="text" style="width: 100%"></td>
						</tr>
						<tr>
							<td><span fckLang="AttachmentDlgOthor">Othor options</span>:</td>
							<td colspan="2"><input id="othor" type="text" style="width: 100%"></td>
						</tr>
						<tr>
							<td><span fckLang="AttachmentDlgAlt">Alternative Text</span>:</td>
							<td colspan="2"><input id="alt" type="text" style="width: 100%"></td>
						</tr>
						<tr>
							<td><span fckLang="AttachmentDlgZoom">Zoom</span>:</td>
							<td  colspan="2">
								<input id="size" type="text" style="width: 40px" onkeydown="ChangeSizeType(true)"> %
							</td>
						</tr>
						<tr>
							<td><span fckLang="AttachmentDlgWidth">Width</span>:</td>
							<td colspan="2">
								<input id="width" type="text" style="width: 40px" onkeydown="ChangeSizeType(false)">px
								(<select id="mw" style="width: 50px" onchange="ChangeSizeType(false)">
									<option value="max" fckLang="AttachmentDlgMax">Max</option>
									<option value="fix" fckLang="AttachmentDlgFix">Fix</option>
								</select>)
							</td>
						</tr>
						<tr>
							<td><span fckLang="AttachmentDlgHeight">Height</span>:</td>
							<td colspan="2">
								<input id="height" type="text" style="width: 40px" onkeydown="ChangeSizeType(false)">px
								(<select id="mh" style="width: 50px" onchange="ChangeSizeType(false)">
									<option value="max" fckLang="AttachmentDlgMax">Max</option>
									<option value="fix" fckLang="AttachmentDlgFix">Fix</option>
								</select>)
							</td>
						</tr>
						<tr>
							<td colspan="3" height="10"></td>
						</tr>
						<tr>
							<td colspan="2">
								<input id="nolink" type="checkbox">
								<label for="nolink" fckLang="AttachmentDlgNoLink">nolink</label>
							</td>
							<td>
								<span fckLang="AttachmentDlgAlign">Align</span>:
								<select id="align" style="width: 100px; margin-left: 10px">
									<option value="" fckLang="AttachmentDlgAlignNo">No</option>
									<option value="left" fckLang="AttachmentDlgAlignLeft">Left</option>
									<option value="center" fckLang="AttachmentDlgAlignCenter">Center</option>
									<option value="right" fckLang="AttachmentDlgAlignRight">Right</option>
								</select>
							</td>
						</tr>
						<tr>
							<td colspan="2">
								<input id="noicon" type="checkbox">
								<label for="noicon" fckLang="AttachmentDlgNoIcon">noicon</label>
							</td>
							<td>
								<input id="wrap" type="checkbox">
								<label for="wrap" fckLang="AttachmentDlgWrap">wrap</label>
							</td>
						</tr>
						<tr>
							<td colspan="2">
								<input id="noimg" type="checkbox">
								<label for="noimg" fckLang="AttachmentDlgNoImg">noimg</label>
							</td>
							<td>
								<input id="around" type="checkbox">
								<label for="around" fckLang="AttachmentDlgAround">around</label>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
	</body>
</html>